{% extends "mturk_manager/base.html" %}
{% load static %}
{% load mturk_manager_templatetags %}

{% block name_project %}
{{ db_obj_project.name }}
{% endblock %}

{% block links_project %}
	<a class="nav-item nav-link" href="{% url 'mturk_manager:project' db_obj_project.name %}">Project</a>
	<a class="nav-item nav-link" href="{% url 'viewer:index' db_obj_project.name %}">View Assignments</a>
	<a class="nav-item nav-link" href="{% url 'viewer:index' db_obj_project.name|add:'_workers' %}">View Workers</a>
{% endblock %}

{% block body %}
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
<link rel="stylesheet" href="{% static 'mturk_manager/css/sublime.css' %}">

<div class="container-fluid" id="page_project">
	<div class="row">
		<div class="col">
			<table class="table table-responsive">
				<thead>
					<tr>
						<th></th>
						<th>Batches</th>
						<th>Hits</th>
						<th>Total assignments</th>
						<th>Processed assignments</th>
						<th>Pending assignments</th>
						<th>New assignments</th>
					</tr>
				</thead>
				<tbody>
					<tr>
						<td>Real</td>
						<td>{{ dict_stats.count_batches }}</td>
						<td>{{ dict_stats.count_hits }}</td>
						<td>{{ dict_stats.count_assignments_total }}</td>
						<td>{{ dict_stats.count_assignments }}</td>
						<td>{{ dict_stats.count_assignments_pending }}</td>
						<td>{{ dict_stats.count_assignments_new }}</td>
					</tr>
					<tr>
						<td>Sandbox</td>
						<td>{{ dict_stats.count_batches_sandbox }}</td>
						<td>{{ dict_stats.count_hits_sandbox }}</td>
						<td>{{ dict_stats.count_assignments_sandbox_total }}</td>
						<td>{{ dict_stats.count_assignments_sandbox }}</td>
						<td>{{ dict_stats.count_assignments_sandbox_pending }}</td>
						<td>{{ dict_stats.count_assignments_sandbox_new }}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	<div class="row">
		<div class="col">
			<form method="post">
				{% csrf_token %}
				<button type="submit" name="task" value="synchronize_database" class="btn btn-primary">Synchronize with MTurk</button>
			</form>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col">
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_create_batch">Create batch</button>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col-12 col-lg-6">
			<form method="post" enctype="multipart/form-data">
				{% csrf_token %}
				<fieldset class="form-group">
					<legend>Default settings</legend>
					<div class="form-row form-group">
						<div class="col">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Title</span>
								</div>
								<input type="text" class="form-control" name="title" value="{{ db_obj_project.title }}">
							</div>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Description</span>
								</div>
								<input type="text" class="form-control" name="description" value="{{ db_obj_project.description }}">
							</div>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col-12 col-md-6 mb-3 mb-md-0">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Reward</span>
								</div>
								<input type="number" class="form-control" name="reward" step="0.01" value="{{ db_obj_project.reward }}">
								<div class="input-group-append">
									<span class="input-group-text">$</span>
								</div>
							</div>
						</div>
						<div class="col-12 col-md-6">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Number of assignments</span>
								</div>
								<input type="number" class="form-control" name="count_assignments" value="{{ db_obj_project.count_assignments }}">
							</div>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col-12 col-md-6 mb-3 mb-md-0">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Lifetime</span>
								</div>
								<input type="number" class="form-control" name="lifetime" value="{{ db_obj_project.lifetime }}">
								<div class="input-group-append">
									<span class="input-group-text">s</span>
								</div>
							</div>
						</div>
						<div class="col-12 col-md-6">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Duration</span>
								</div>
								<input type="number" class="form-control" name="duration" value="{{ db_obj_project.duration }}">
								<div class="input-group-append">
									<span class="input-group-text">s</span>
								</div>
							</div>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Keywords (comma-separated)</span>
								</div>
								<input type="text" class="form-control" name="keywords" value="{{ db_obj_project.keywords }}">
							</div>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col input-group">
							<div class="input-group-prepend">
								<label class="input-group-text">Use sandbox</label>
							</div>
							<select class="custom-select" name="use_sandbox">
								<option value="0" {% if False ==  db_obj_project.use_sandbox %}selected{% endif %}>no</option>
								<option value="1" {% if True ==  db_obj_project.use_sandbox %}selected{% endif %}>yes</option>
							</select>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col input-group">
							<div class="input-group-prepend">
								<label class="input-group-text">Default worker template</label>
							</div>
							<select class="custom-select" name="template_main">
								<option value="">please select a template</option>
							{% for template in db_obj_project.templates.all %}
							{% if template.is_active %}
								<option value="{{ template.id }}" {% if template ==  db_obj_project.fk_template_main %}selected{% endif %}>{{ template.name }}</option>
							{% endif %}
							{% endfor %}
							</select>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col input-group">
							<div class="input-group-prepend">
								<label class="input-group-text">Default requester assignment template</label>
							</div>
							<select class="custom-select" name="template_assignment_main">
								<option value="">please select a template</option>
							{% for template in db_obj_project.templates_assignment.all %}
							{% if template.is_active %}
								<option value="{{ template.id }}" {% if template ==  db_obj_project.fk_template_assignment_main %}selected{% endif %}>{{ template.name }}</option>
							{% endif %}
							{% endfor %}
							</select>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col input-group">
							<div class="input-group-prepend">
								<label class="input-group-text">Default requester hit template</label>
							</div>
							<select class="custom-select" name="template_hit_main">
								<option value="">please select a template</option>
							{% for template in db_obj_project.templates_hit.all %}
							{% if template.is_active %}
								<option value="{{ template.id }}" {% if template ==  db_obj_project.fk_template_hit_main %}selected{% endif %}>{{ template.name }}</option>
							{% endif %}
							{% endfor %}
							</select>
						</div>
					</div>
					<div class="form-row form-group">
						<div class="col input-group">
							<div class="input-group-prepend">
								<label class="input-group-text">Default reject message</label>
							</div>
							<select class="custom-select" name="message_reject_default">
								<option value="">please select a reject message</option>
							{% for message in db_obj_project.messages_reject.all %}
								<option value="{{ message.id }}" {% if message ==  db_obj_project.fk_message_reject_default %}selected{% endif %}>{{ message.message }}</option>
							{% endfor %}
							</select>
						</div>
					</div>
					<button type="submit" name="task" value="update_settings" class="btn btn-primary">Update</button>
				</fieldset>
			</form>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col">
			<form method="post">
				<div class="row">
					<div class="col">
						{% csrf_token %}
						<fieldset>
							<legend>Manage worker templates</legend>
							<table class="table table-sm">
								<thead>
									<tr>
										<th>Selection</th>
										<th>Name</th>
										<th>Frame height</th>
										<th>Parameters</th>
										<th>Assignment template</th>
										<th>Hit template</th>
										<th>Update</th>
										<th>HTML</th>
									</tr>
								</thead>
								<tbody>
								{% for template in list_templates_active %}
									<tr {% if template ==  db_obj_project.fk_template_main %}class="table-active"{% endif %}>
										<td>
											<div class="custom-control custom-checkbox">
												<input type="checkbox" name="templates" value="{{ template.id }}" id="checkbox_manage_templates_template_{{ template.id }}" class="custom-control-input">
												<label class="custom-control-label" for="checkbox_manage_templates_template_{{ template.id }}"></label>
											</div>
										</td>
										<td>
											{{ template.name }}
										</td>
										<td>
											{{ template.height_frame }}
										</td>
										<td>
											{% get_count_distinct_parameters template.json_dict_parameters %}
										</td>
										<td>
											{% if template.fk_template_assignment.name == 'default_template_assignment__'|add:db_obj_project.name %}
												-
											{% else %}
												{{ template.fk_template_assignment.name }}
											{% endif %}
										</td>
										<td>
											{% if template.fk_template_hit.name == 'default_template_hit__'|add:db_obj_project.name %}
												-
											{% else %}
												{{ template.fk_template_hit.name }}
											{% endif %}
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-name="{{ template.name }}" data-height_frame="{{ template.height_frame }}" data-id_template_assignment="{{ template.fk_template_assignment.id }}" data-id_template_hit="{{ template.fk_template_hit.id }}" data-toggle="modal" data-target="#modal_update_template">Update</button>
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-template="{{ template.template }}" data-toggle="modal" data-target="#modal_show_html">Show</button>
										</td>
									</tr>
								{% endfor %}
								</tbody>
							</table>
						</fieldset>
					</div>
				</div>
				<div class="row mb-2">
					<div class="col">
						<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_add_template">Add template</button>
						{% if db_obj_project.templates.count > 0 %}
						<button type="submit" name="task" value="delete_templates" class="btn btn-danger">Delete selected</button>
						{% endif %}
					</div>
				</div>
				{% if list_templates_inactive|length > 0 %}
				<div class="row">
					<div class="col">
						<button type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#collapse_templates_inactive">Toggle inactive templates</button>
					</div>
				</div>
				<div class="row mt-2 collapse" id="collapse_templates_inactive">
					<div class="col">
						<table class="table table-sm">
							<thead>
								<tr>
									<th>Selection</th>
									<th>Name</th>
									<th>Frame height</th>
									<th>Parameters</th>
									<th>Assignment template</th>
									<th>Hit template</th>
									<th>Update</th>
									<th>HTML</th>
								</tr>
							</thead>
							<tbody>
							{% for template in list_templates_inactive %}
								<tr {% if template ==  db_obj_project.fk_template_main %}class="table-active"{% endif %}>
									<td>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" name="templates" value="{{ template.id }}" id="checkbox_manage_templates_template_{{ template.id }}" class="custom-control-input">
											<label class="custom-control-label" for="checkbox_manage_templates_template_{{ template.id }}"></label>
										</div>
									</td>
									<td>
										{{ template.name }}
									</td>
									<td>
										{{ template.height_frame }}
									</td>
									<td>
										{% get_count_distinct_parameters template.json_dict_parameters %}
									</td>
									<td>
										{% if template.fk_template_assignment.name == 'default_template_assignment__'|add:db_obj_project.name %}
											-
										{% else %}
											{{ template.fk_template_assignment.name }}
										{% endif %}
									</td>
									<td>
										{% if template.fk_template_hit.name == 'default_template_hit__'|add:db_obj_project.name %}
											-
										{% else %}
											{{ template.fk_template_hit.name }}
										{% endif %}
									</td>
									<td>
										<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-name="{{ template.name }}" data-height_frame="{{ template.height_frame }}" data-id_template_assignment="{{ template.fk_template_assignment.id }}" data-id_template_hit="{{ template.fk_template_hit.id }}" data-toggle="modal" data-target="#modal_update_template">Update</button>
									</td>
									<td>
										<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-template="{{ template.template }}" data-toggle="modal" data-target="#modal_show_html">Show</button>
									</td>
								</tr>
							{% endfor %}
							</tbody>
						</table>
						<button type="submit" name="task" value="reactivate_templates" class="btn btn-info btn-sm">Reactivate selected</button>
					</div>
				</div>
				{% endif %}
			</form>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col">
			<form method="post">
				<div class="row">
					<div class="col">
						{% csrf_token %}
						<fieldset>
							<legend>Manage requester assignment templates</legend>
							<table class="table table-sm">
								<thead>
									<tr>
										<th>Selection</th>
										<th>Name</th>
										<th>Update</th>
										<th>HTML</th>
									</tr>
								</thead>
								<tbody>
									{% for template in list_templates_assignment_active %}
									<tr {% if template ==  db_obj_project.fk_template_assignment_main %}class="table-active"{% endif %}>
										<td>
											<div class="custom-control custom-checkbox">
												<input type="checkbox" name="templates" value="{{ template.id }}" id="checkbox_manage_templates_assignment_template_{{ template.id }}" class="custom-control-input">
												<label class="custom-control-label" for="checkbox_manage_templates_assignment_template_{{ template.id }}"></label>
											</div>
										</td>
										<td>
											{{ template.name }}
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-name="{{ template.name }}" data-toggle="modal" data-target="#modal_update_template_assignment">Update</button>
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-template="{{ template.template }}" data-toggle="modal" data-target="#modal_show_html">Show</button>
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</fieldset>
					</div>
				</div>
				<div class="row mb-2">
					<div class="col">
						<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_add_template_assignment">Add template</button>
						{% if db_obj_project.templates_assignment.count > 0 %}
						<button type="submit" name="task" value="delete_templates_assignment" class="btn btn-danger">Delete selected</button>
						{% endif %}
					</div>
				</div>
				{% if list_templates_assignment_inactive|length > 0 %}
				<div class="row">
					<div class="col">
						<button type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#collapse_templates_assignment_inactive">Toggle inactive assignment templates</button>
					</div>
				</div>
				<div class="row mt-2 collapse" id="collapse_templates_assignment_inactive">
					<div class="col">
						<table class="table table-sm">
							<thead>
								<tr>
									<th>Selection</th>
									<th>Name</th>
									<th>Update</th>
									<th>HTML</th>
								</tr>
							</thead>
							<tbody>
								{% for template in list_templates_assignment_inactive %}
								<tr {% if template ==  db_obj_project.fk_template_assignment_main %}class="table-active"{% endif %}>
									<td>
										<div class="custom-control custom-checkbox">
											<input type="checkbox" name="templates" value="{{ template.id }}" id="checkbox_manage_templates_assignment_template_{{ template.id }}" class="custom-control-input">
											<label class="custom-control-label" for="checkbox_manage_templates_assignment_template_{{ template.id }}"></label>
										</div>
									</td>
									<td>
										{{ template.name }}
									</td>
									<td>
										<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-name="{{ template.name }}" data-toggle="modal" data-target="#modal_update_template_assignment">Update</button>
									</td>
									<td>
										<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-template="{{ template.template }}" data-toggle="modal" data-target="#modal_show_html">Show</button>
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
						<button type="submit" name="task" value="reactivate_templates_assignment" class="btn btn-info btn-sm">Reactivate selected</button>
					</div>
				</div>
				{% endif %}
			</form>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col">
			<form method="post">
				<div class="row">
					<div class="col">
						{% csrf_token %}
						<fieldset>
							<legend>Manage requester hit templates</legend>
							<table class="table table-sm table-responsive-lg">
								<thead>
									<tr>
										<th>Selection</th>
										<th>Name</th>
										<th>Update</th>
										<th>HTML</th>
									</tr>
								</thead>
								<tbody>
									{% for template in list_templates_hit_active %}
									<tr {% if template ==  db_obj_project.fk_template_hit_main %}class="table-active"{% endif %}>
										<td>
											<div class="custom-control custom-checkbox">
												<input type="checkbox" name="templates" value="{{ template.id }}" id="checkbox_manage_templates_hit_template_{{ template.id }}" class="custom-control-input">
												<label class="custom-control-label" for="checkbox_manage_templates_hit_template_{{ template.id }}"></label>
											</div>
										</td>
										<td>
											{{ template.name }}
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-name="{{ template.name }}" data-toggle="modal" data-target="#modal_update_template_hit">Update</button>
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-template="{{ template.template }}" data-toggle="modal" data-target="#modal_show_html">Show</button>
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						</fieldset>
					</div>
				</div>
				<div class="row mb-2">
					<div class="col">
						<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_add_template_hit">Add template</button>
						{% if db_obj_project.templates_hit.count > 0 %}
						<button type="submit" name="task" value="delete_templates_hit" class="btn btn-danger">Delete selected</button>
						{% endif %}
					</div>
				</div>
				{% if list_templates_hit_inactive|length > 0 %}
				<div class="row">
					<div class="col">
						<button type="button" class="btn btn-primary btn-sm" data-toggle="collapse" data-target="#collapse_templates_hit_inactive">Toggle inactive assignment templates</button>
					</div>
				</div>
				<div class="row mt-2 collapse" id="collapse_templates_hit_inactive">
					<div class="col">
						<table class="table table-sm">
							<table class="table table-sm">
								<thead>
									<tr>
										<th>Selection</th>
										<th>Name</th>
										<th>Update</th>
										<th>HTML</th>
									</tr>
								</thead>
								<tbody>
									{% for template in list_templates_hit_inactive %}
									<tr {% if template ==  db_obj_project.fk_template_hit_main %}class="table-active"{% endif %}>
										<td>
											<div class="custom-control custom-checkbox">
												<input type="checkbox" name="templates" value="{{ template.id }}" id="checkbox_manage_templates_hit_template_{{ template.id }}" class="custom-control-input">
												<label class="custom-control-label" for="checkbox_manage_templates_hit_template_{{ template.id }}"></label>
											</div>
										</td>
										<td>
											{{ template.name }}
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-name="{{ template.name }}" data-toggle="modal" data-target="#modal_update_template_hit">Update</button>
										</td>
										<td>
											<button type="button" class="btn btn-primary btn-sm" data-id="{{ template.id }}" data-template="{{ template.template }}" data-toggle="modal" data-target="#modal_show_html">Show</button>
										</td>
									</tr>
									{% endfor %}
								</tbody>
							</table>
						<button type="submit" name="task" value="reactivate_templates_hit" class="btn btn-info btn-sm">Reactivate selected</button>
					</div>
				</div>
				{% endif %}
			</form>
		</div>
	</div>
	<hr>
	<div class="row">
		<div class="col-12 col-lg-6">
			<form method="post">
				{% csrf_token %}
				<fieldset>
					<legend>Manage reject messages</legend>
					<table class="table table-sm table-responsive-lg">
						<thead>
							<tr>
								<th>Selection</th>
								<th>Message</th>
								<th>Update</th>
							</tr>
						</thead>
						<tbody>
							{% for message in db_obj_project.messages_reject.all %}
							<tr>
								<td>
									<div class="custom-control custom-checkbox">
										<input type="checkbox" name="messages" value="{{ message.id }}" id="checkbox_manage_messages_reject_{{ message.id }}" class="custom-control-input">
										<label class="custom-control-label" for="checkbox_manage_messages_reject_{{ message.id }}"></label>
									</div>
								</td>
								<td>
									{{ message.message }}
								</td>
								<td>
									<button type="button" class="btn btn-primary btn-sm" data-id="{{ message.id }}" data-message="{{ message.message }}" data-toggle="modal" data-target="#modal_update_message_reject">Update</button>
								</td>
							</tr>
							{% endfor %}
						</tbody>
					</table>
					<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modal_add_message_reject">Add message</button>
					{% if db_obj_project.messages_reject.count > 0 %}
					<button type="submit" name="task" value="delete_messages_reject" class="btn btn-danger">Delete selected</button>
					{% endif %}
				</fieldset>
			</form>
		</div>
	</div>
	<hr>
	<button type="button" class="btn btn-danger" data-toggle="modal" data-target="#modal_delete_project">Delete project</button>
	<button type="button" class="btn btn-warning" data-toggle="modal" data-target="#modal_clear_sandbox">Clear sandbox</button>
</div>

<div class="modal fade" tabindex="-1" id="modal_update_message_reject">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Update reject message</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<input type="hidden" name="id">
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Message</span>
								</div>
								<input type="text" class="form-control" name="message" maxlength="1024">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="update_message_reject" class="btn btn-primary">Add</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_add_message_reject">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add reject message</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Message</span>
								</div>
								<input type="text" class="form-control" name="message" maxlength="1024">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="add_message_reject" class="btn btn-primary">Add</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_show_html">
	<div class="modal-dialog modal-lg modal-xxl">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">HTML</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<pre><code class="html"></code></pre>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_delete_project">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Do you really want to delete this project?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				{% csrf_token %}
				<div class="modal-footer">
					<button type="submit" name="task" value="delete_project" class="btn btn-danger">Delete</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_clear_sandbox">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Do you really want to clear the sandbox?</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				{% csrf_token %}
				<div class="modal-footer">
					<button type="submit" name="task" value="clear_sandbox" class="btn btn-warning">Clear</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_create_batch">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Create batch</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the batch">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
							  	<div class="input-group-prepend">
						    		<span class="input-group-text">CSV file</span>
							  	</div>
								<label class="custom-file">
									<input type="file" name="file_csv" class="custom-file-input">
									<span class="custom-file-label"></span>
								</label>
							</div>
						</div>
						<hr>
						<div class="form-row form-group">
							<div class="col">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Title</span>
									</div>
									<input type="text" class="form-control" name="title" value="{{ db_obj_project.title }}">
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Description</span>
									</div>
									<input type="text" class="form-control" name="description" value="{{ db_obj_project.description }}">
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-md-6 mb-3 mb-md-0">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Reward</span>
									</div>
									<input type="number" class="form-control" name="reward" step="0.01" value="{{ db_obj_project.reward }}">
									<div class="input-group-append">
										<span class="input-group-text">$</span>
									</div>
								</div>
							</div>
							<div class="col-12 col-md-6">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Number of assignments</span>
									</div>
									<input type="number" class="form-control" name="count_assignments" value="{{ db_obj_project.count_assignments }}">
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-md-6 mb-3 mb-md-0">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Lifetime</span>
									</div>
									<input type="number" class="form-control" name="lifetime" value="{{ db_obj_project.lifetime }}">
									<div class="input-group-append">
										<span class="input-group-text">s</span>
									</div>
								</div>
							</div>
							<div class="col-12 col-md-6">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Duration</span>
									</div>
									<input type="number" class="form-control" name="duration" value="{{ db_obj_project.duration }}">
									<div class="input-group-append">
										<span class="input-group-text">s</span>
									</div>
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Keywords (comma-separated)</span>
									</div>
									<input type="text" class="form-control" name="keywords" value="{{ db_obj_project.keywords }}">
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<label class="input-group-text">Use sandbox</label>
								</div>
								<select class="custom-select" name="use_sandbox">
									<option value="0" {% if False ==  db_obj_project.use_sandbox %}selected{% endif %}>no</option>
									<option value="1" {% if True ==  db_obj_project.use_sandbox %}selected{% endif %}>yes</option>
								</select>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<label class="input-group-text">Worker template</label>
								</div>
								<select class="custom-select" name="template">
									<option value="">please select a template</option>
								{% for template in db_obj_project.templates.all %}
								{% if template.is_active %}
									<option value="{{ template.id }}" {% if template ==  db_obj_project.fk_template_main %}selected{% endif %}>{{ template.name }}</option>
								{% endif %}
								{% endfor %}
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="create_batch" class="btn btn-primary">Create</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_add_template_hit">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add requester hit template</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the template">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-lg-auto mb-3 mb-lg-0">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML snippet</span>
								  	</div>
								  	<textarea class="form-control" name="html_template" placeholder="paste the HTML code here" rows="1" style="resize: none;"></textarea>
								</div>
							</div>
							<div class="col-auto d-flex align-items-center">
								<div class="">or</div>
							</div>
							<div class="col">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML file</span>
								  	</div>
									<label class="custom-file">
										<input type="file" name="file_template" class="custom-file-input">
										<span class="custom-file-label"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="add_template_hit" class="btn btn-primary">Add</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_add_template_assignment">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add requester assignment template</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the template">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-lg-auto mb-3 mb-lg-0">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML snippet</span>
								  	</div>
								  	<textarea class="form-control" name="html_template" placeholder="paste the HTML code here" rows="1" style="resize: none;"></textarea>
								</div>
							</div>
							<div class="col-auto d-flex align-items-center">
								<div class="">or</div>
							</div>
							<div class="col">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML file</span>
								  	</div>
									<label class="custom-file">
										<input type="file" name="file_template" class="custom-file-input">
										<span class="custom-file-label"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="add_template_assignment" class="btn btn-primary">Add</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_update_template_hit">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Update requester hit template</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<input type="hidden" name="id">
						<div class="form-row form-group">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the template">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-lg-auto mb-3 mb-lg-0">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML snippet</span>
								  	</div>
								  	<textarea class="form-control" name="html_template" placeholder="paste the HTML code here" rows="1" style="resize: none;"></textarea>
								</div>
							</div>
							<div class="col-auto d-flex align-items-center">
								<div class="">or</div>
							</div>
							<div class="col">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML file</span>
								  	</div>
									<label class="custom-file">
										<input type="file" name="file_template" class="custom-file-input">
										<span class="custom-file-label"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="update_template_hit" class="btn btn-primary">Update</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_update_template_assignment">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Update requester assignment template</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<input type="hidden" name="id">
						<div class="form-row form-group">
							<div class="input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the template">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-lg-auto mb-3 mb-lg-0">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML snippet</span>
								  	</div>
								  	<textarea class="form-control" name="html_template" placeholder="paste the HTML code here" rows="1" style="resize: none;"></textarea>
								</div>
							</div>
							<div class="col-auto d-flex align-items-center">
								<div class="">or</div>
							</div>
							<div class="col">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML file</span>
								  	</div>
									<label class="custom-file">
										<input type="file" name="file_template" class="custom-file-input">
										<span class="custom-file-label"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="update_template_assignment" class="btn btn-primary">Update</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_update_template">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Update worker template</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<input type="hidden" name="id">
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the template">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-lg-auto mb-3 mb-lg-0">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML snippet</span>
								  	</div>
								  	<textarea class="form-control" name="html_template" placeholder="paste the HTML code here" rows="1" style="resize: none;"></textarea>
								</div>
							</div>
							<div class="col-auto d-flex align-items-center">
								<div class="">or</div>
							</div>
							<div class="col">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML file</span>
								  	</div>
									<label class="custom-file">
										<input type="file" name="file_template" class="custom-file-input">
										<span class="custom-file-label"></span>
									</label>
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Frame height</span>
									</div>
									<input type="number" class="form-control" name="height_frame" value="800">
									<div class="input-group-append">
										<span class="input-group-text">px</span>
									</div>
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<label class="input-group-text">Assignment template</label>
								</div>
								<select class="custom-select" name="template_assignment">
									<option value="">please select a template</option>
								{% for template in db_obj_project.templates_assignment.all %}
								{% if template.is_active %}
									<option value="{{ template.id }}" {% if template == db_obj_project.fk_template_assignment_main %}selected{% endif %}>{{ template.name }}</option>
								{% endif %}
								{% endfor %}
								</select>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<label class="input-group-text">Hit template</label>
								</div>
								<select class="custom-select" name="template_hit">
									<option value="">please select a template</option>
								{% for template in db_obj_project.templates_hit.all %}
								{% if template.is_active %}
									<option value="{{ template.id }}" {% if template == db_obj_project.fk_template_hit_main %}selected{% endif %}>{{ template.name }}</option>
								{% endif %}
								{% endfor %}
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="update_template" class="btn btn-primary">Update</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>

<div class="modal fade" tabindex="-1" id="modal_add_template">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title">Add worker template</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<form method="post" enctype="multipart/form-data">
				<div class="modal-body">
					<div class="container-fluid">
						{% csrf_token %}
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<span class="input-group-text">Name</span>
								</div>
								<input type="text" class="form-control" name="name" maxlength="200" placeholder="Name of the template">
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col-12 col-lg-auto mb-3 mb-lg-0">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML template</span>
								  	</div>
								  	<textarea class="form-control" name="html_template" placeholder="paste the HTML code here" rows="1" style="resize: none;"></textarea>
								</div>
							</div>
							<div class="col-auto d-flex align-items-center">
								<div class="">or</div>
							</div>
							<div class="col">
								<div class="input-group">
								  	<div class="input-group-prepend">
							    		<span class="input-group-text">HTML file</span>
								  	</div>
									<label class="custom-file">
										<input type="file" name="file_template" class="custom-file-input">
										<span class="custom-file-label"></span>
									</label>
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col">
								<div class="input-group">
									<div class="input-group-prepend">
										<span class="input-group-text">Frame height</span>
									</div>
									<input type="number" class="form-control" name="height_frame" value="800">
									<div class="input-group-append">
										<span class="input-group-text">px</span>
									</div>
								</div>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<label class="input-group-text">Assignment template</label>
								</div>
								<select class="custom-select" name="template_assignment">
									<option value="">please select a template</option>
								{% for template in db_obj_project.templates_assignment.all %}
								{% if template.is_active %}
									<option value="{{ template.id }}" {% if template ==  db_obj_project.fk_template_assignment_main %}selected{% endif %}>{{ template.name }}</option>
								{% endif %}
								{% endfor %}
								</select>
							</div>
						</div>
						<div class="form-row form-group">
							<div class="col input-group">
								<div class="input-group-prepend">
									<label class="input-group-text">Hit template</label>
								</div>
								<select class="custom-select" name="template_hit">
									<option value="">please select a template</option>
								{% for template in db_obj_project.templates_hit.all %}
								{% if template.is_active %}
									<option value="{{ template.id }}" {% if template ==  db_obj_project.fk_template_hit_main %}selected{% endif %}>{{ template.name }}</option>
								{% endif %}
								{% endfor %}
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="submit" name="task" value="add_template" class="btn btn-primary">Add</button>
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				</div>
			</form>
		</div>
	</div>
</div>
{% endblock %}

{% block javascript %}
	{{ block.super }}
	<script src="{% static 'mturk_manager/js/highlight.pack.js' %}"></script>
	<script src="{% static 'mturk_manager/js/project.js' %}"></script>
{% endblock %}
